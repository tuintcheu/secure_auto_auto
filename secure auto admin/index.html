<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecurAuto Admin - Gestion des V√©hicules Vol√©s</title>
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%235D5CDE' viewBox='0 0 24 24'%3E%3Cpath d='M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11.5H16.2V16H7.8V11.5H9.2V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.4,8.7 10.4,10V11.5H13.6V10C13.6,8.7 12.8,8.2 12,8.2Z'/%3E%3C/svg%3E">
    
    <!-- External CDN Resources -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>
    
    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#1A237E',
                        'primary-dark': '#4C4BC7',
                        'secondary-dark': '#0F1419'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- Custom Styles -->
    <style>
        /* Ic√¥nes personnalis√©es sans FontAwesome */
        .icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            vertical-align: middle;
        }
        
        /* Ic√¥nes SVG int√©gr√©es */
        .icon-shield::before { content: "üõ°Ô∏è"; }
        .icon-dashboard::before { content: "üìä"; }
        .icon-car::before { content: "üöó"; }
        .icon-search::before { content: "üîç"; }
        .icon-money::before { content: "üí∞"; }
        .icon-chart::before { content: "üìà"; }
        .icon-users::before { content: "üë•"; }
        .icon-bell::before { content: "üîî"; }
        .icon-user::before { content: "üë§"; }
        .icon-settings::before { content: "‚öôÔ∏è"; }
        .icon-logout::before { content: "üö™"; }
        .icon-eye::before { content: "üëÅÔ∏è"; }
        .icon-eye-off::before { content: "üôà"; }
        .icon-lock::before { content: "üîí"; }
        .icon-mail::before { content: "üìß"; }
        .icon-check::before { content: "‚úÖ"; }
        .icon-warning::before { content: "‚ö†Ô∏è"; }
        .icon-error::before { content: "‚ùå"; }
        .icon-info::before { content: "‚ÑπÔ∏è"; }
        .icon-close::before { content: "‚ùå"; }
        .icon-edit::before { content: "‚úèÔ∏è"; }
        .icon-delete::before { content: "üóëÔ∏è"; }
        .icon-download::before { content: "‚¨áÔ∏è"; }
        .icon-plus::before { content: "‚ûï"; }
        .icon-calendar::before { content: "üìÖ"; }
        .icon-location::before { content: "üìç"; }
        .icon-sun::before { content: "‚òÄÔ∏è"; }
        .icon-moon::before { content: "üåô"; }
        .icon-help::before { content: "‚ùì"; }
        .icon-history::before { content: "üìú"; }
        .icon-sync::before { content: "üîÑ"; }
        
        /* Autres styles personnalis√©s */
        .admin-gradient {
            background: linear-gradient(135deg, #5D5CDE 0%, #1A237E 100%);
        }
        
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #5D5CDE;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        .loading-spinner-sm {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #5D5CDE;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .nav-item {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: #5D5CDE;
            border-radius: 2px 2px 0 0;
        }
        
        .notification-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* Boutons stylis√©s */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #5D5CDE 0%, #1A237E 100%);
            color: white;
        }
        
        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        
        /* Alertes */
        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid;
        }
        
        .alert-success {
            background-color: #f0fdf4;
            border-color: #10b981;
            color: #065f46;
        }
        
        .alert-error {
            background-color: #fef2f2;
            border-color: #ef4444;
            color: #991b1b;
        }
        
        .alert-warning {
            background-color: #fffbeb;
            border-color: #f59e0b;
            color: #92400e;
        }
        
        .alert-info {
            background-color: #eff6ff;
            border-color: #3b82f6;
            color: #1e40af;
        }
        
        /* Mode sombre */
        .dark .alert-success {
            background-color: #064e3b;
            color: #a7f3d0;
        }
        
        .dark .alert-error {
            background-color: #7f1d1d;
            color: #fca5a5;
        }
        
        .dark .alert-warning {
            background-color: #78350f;
            color: #fcd34d;
        }
        
        .dark .alert-info {
            background-color: #1e3a8a;
            color: #93c5fd;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 font-sans">
    <!-- Application Container -->
    <div id="app" class="min-h-screen">
        
        <!-- √âcran d'initialisation -->
        <div id="initializationScreen" class="hidden fixed inset-0 bg-white dark:bg-gray-900 flex items-center justify-center z-50">
            <div class="text-center max-w-md mx-auto p-8">
                <div class="mb-6">
                    <div class="h-16 w-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="icon-shield text-white text-2xl"></span>
                    </div>
                    <div class="loading-spinner mx-auto mb-4"></div>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
                    Initialisation de SecurAuto Admin
                </h2>
                <div id="initProgress" class="space-y-2 text-left">
                    <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                        <span class="icon-sync mr-2"></span>
                        <span>D√©marrage de l'initialisation...</span>
                    </div>
                </div>
                <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900 rounded-lg text-sm text-blue-800 dark:text-blue-200">
                    <p><strong>Premi√®re installation d√©tect√©e</strong></p>
                    <p>Configuration automatique de Firebase en cours...</p>
                </div>
            </div>
        </div>
        
        <!-- Loading Screen -->
        <div id="loadingScreen" class="fixed inset-0 bg-white dark:bg-gray-900 flex items-center justify-center z-50">
            <div class="text-center">
                <div class="mb-6">
                    <div class="h-16 w-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="icon-shield text-white text-2xl"></span>
                    </div>
                    <div class="loading-spinner mx-auto"></div>
                </div>
                <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
                    SecurAuto Admin
                </h2>
                <p class="text-gray-600 dark:text-gray-400 text-sm">
                    Chargement de l'interface d'administration...
                </p>
            </div>
        </div>

        <!-- Login Screen -->
        <div id="loginScreen" class="hidden min-h-screen flex">
            <!-- Left Panel - Branding -->
            <div class="hidden lg:flex lg:w-1/2 admin-gradient">
                <div class="flex flex-col justify-center px-12 py-16 text-white">
                    <div class="mb-8">
                        <div class="h-20 w-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center mb-6">
                            <span class="icon-shield text-4xl"></span>
                        </div>
                        <h1 class="text-4xl font-bold mb-4">SecurAuto Admin</h1>
                        <p class="text-xl text-white text-opacity-90 mb-6">
                            Syst√®me de gestion des v√©hicules vol√©s
                        </p>
                        <p class="text-white text-opacity-75">
                            Interface d'administration s√©curis√©e pour la Gendarmerie du Cameroun
                        </p>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="flex items-center text-white text-opacity-90">
                            <span class="icon-check mr-3"></span>
                            <span>Gestion des v√©hicules vol√©s</span>
                        </div>
                        <div class="flex items-center text-white text-opacity-90">
                            <span class="icon-check mr-3"></span>
                            <span>Suivi des d√©tections en temps r√©el</span>
                        </div>
                        <div class="flex items-center text-white text-opacity-90">
                            <span class="icon-check mr-3"></span>
                            <span>Gestion des r√©compenses</span>
                        </div>
                        <div class="flex items-center text-white text-opacity-90">
                            <span class="icon-check mr-3"></span>
                            <span>Rapports et statistiques</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel - Login Form -->
            <div class="w-full lg:w-1/2 flex items-center justify-center px-8 py-16">
                <div class="w-full max-w-md space-y-8">
                    <!-- Mobile Logo -->
                    <div class="lg:hidden text-center mb-8">
                        <div class="h-16 w-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="icon-shield text-white text-2xl"></span>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">SecurAuto Admin</h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-2">Gendarmerie du Cameroun</p>
                    </div>
                    
                    <div class="text-center">
                        <h2 class="text-3xl font-extrabold text-gray-900 dark:text-white">
                            Connexion s√©curis√©e
                        </h2>
                        <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                            Acc√©dez √† votre interface d'administration
                        </p>
                    </div>
                    
                    <!-- Login Form -->
                    <form id="loginForm" class="mt-8 space-y-6" onsubmit="handleLogin(event)">
                        <input type="hidden" name="csrf_token" id="csrfToken">
                        
                        <div class="space-y-4">
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Adresse email
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <span class="icon-mail text-gray-400"></span>
                                    </div>
                                    <input 
                                        id="email" 
                                        name="email" 
                                        type="email" 
                                        autocomplete="email" 
                                        required 
                                        class="block w-full pl-10 pr-3 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base"
                                        placeholder="admin.global@securAuto.cm"
                                        maxlength="100"
                                    >
                                </div>
                            </div>
                            
                            <div>
                                <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Mot de passe
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <span class="icon-lock text-gray-400"></span>
                                    </div>
                                    <input 
                                        id="password" 
                                        name="password" 
                                        type="password" 
                                        autocomplete="current-password" 
                                        required 
                                        class="block w-full pl-10 pr-10 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base"
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        minlength="8"
                                        maxlength="50"
                                    >
                                    <button 
                                        type="button" 
                                        onclick="togglePasswordVisibility()"
                                        class="absolute inset-y-0 right-0 pr-3 flex items-center"
                                    >
                                        <span id="passwordToggleIcon" class="icon-eye text-gray-400 hover:text-gray-600"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Security Features -->
                        <div id="securityFeatures" class="space-y-3">
                            <!-- Login Attempts Warning -->
                            <div id="loginAttempts" class="hidden alert alert-error">
                                <div class="flex items-center">
                                    <span class="icon-warning mr-2"></span>
                                    <div>
                                        <p class="font-medium">Compte temporairement verrouill√©</p>
                                        <p class="text-sm">Trop de tentatives. R√©essayez dans <span id="lockoutTimer">60</span> secondes.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Login Button -->
                        <div>
                            <button 
                                type="submit" 
                                id="loginButton"
                                class="btn btn-primary w-full py-3 text-base font-medium"
                            >
                                <span id="loginText">Se connecter</span>
                                <div id="loginLoader" class="loading-spinner-sm hidden ml-2"></div>
                            </button>
                        </div>
                        
                        <!-- Help -->
                        <div class="text-center">
                            <button type="button" onclick="showLoginHelp()" class="text-sm text-primary hover:text-primary-dark">
                                <span class="icon-help mr-1"></span>Aide √† la connexion
                            </button>
                        </div>
                    </form>
                    
                    <!-- Security Notice -->
                    <div class="mt-8 p-4 bg-blue-50 dark:bg-blue-900 rounded-lg border border-blue-200 dark:border-blue-700">
                        <div class="flex">
                            <span class="icon-info text-blue-400 mr-3 mt-1"></span>
                            <div>
                                <h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">
                                    Connexion s√©curis√©e
                                </h3>
                                <p class="mt-1 text-sm text-blue-700 dark:text-blue-300">
                                    Session automatiquement ferm√©e apr√®s 30 minutes d'inactivit√©.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden min-h-screen bg-gray-50 dark:bg-gray-900">
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 shadow-sm border-b sticky top-0 z-40">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center py-4">
                        <!-- Left Section -->
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center">
                                <div class="h-10 w-10 bg-primary rounded-lg flex items-center justify-center">
                                    <span class="icon-shield text-white text-lg"></span>
                                </div>
                                <div class="ml-3">
                                    <h1 class="text-xl font-bold text-gray-900 dark:text-white">
                                        SecurAuto Admin
                                    </h1>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        Gendarmerie du Cameroun
                                    </p>
                                </div>
                            </div>
                            
                            <!-- User Info Badges -->
                            <div class="hidden sm:flex items-center space-x-2">
                                <span id="userRoleBadge" class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs font-medium rounded-full">
                                    <!-- Sera rempli par JS -->
                                </span>
                                <span id="userRegionBadge" class="hidden px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs font-medium rounded-full">
                                    <!-- Sera rempli par JS -->
                                </span>
                            </div>
                        </div>
                        
                        <!-- Right Section -->
                        <div class="flex items-center space-x-4">
                            <!-- Mode sombre -->
                            <button 
                                id="darkModeToggle"
                                onclick="toggleDarkMode()"
                                class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700"
                            >
                                <span id="darkModeIcon" class="icon-moon"></span>
                            </button>
                            
                            <!-- Notifications -->
                            <div class="relative">
                                <button 
                                    id="notificationButton" 
                                    onclick="toggleNotifications()"
                                    class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 relative"
                                >
                                    <span class="icon-bell"></span>
                                    <span id="notificationBadge" class="hidden absolute -top-1 -right-1 h-5 w-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center notification-pulse font-medium">0</span>
                                </button>
                                
                                <!-- Notification Panel -->
                                <div id="notificationPanel" class="hidden absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-lg border max-h-96 overflow-y-auto z-50">
                                    <div class="p-4 border-b">
                                        <h3 class="font-semibold text-gray-900 dark:text-white">Notifications</h3>
                                    </div>
                                    <div id="notificationList">
                                        <!-- Sera rempli par JS -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- User Menu -->
                            <div class="relative">
                                <button 
                                    id="userMenuButton" 
                                    onclick="toggleUserMenu()"
                                    class="flex items-center text-sm rounded-full bg-white dark:bg-gray-800 p-1 focus:outline-none focus:ring-2 focus:ring-primary"
                                >
                                    <span class="icon-user text-primary text-lg"></span>
                                    <span id="userName" class="hidden sm:block ml-2 text-gray-700 dark:text-gray-300 font-medium">
                                        <!-- Sera rempli par JS -->
                                    </span>
                                </button>
                                
                                <!-- User Menu Dropdown -->
                                <div id="userMenu" class="hidden absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border z-50">
                                    <div class="py-1">
                                        <div class="px-4 py-3 text-sm border-b">
                                            <div class="font-medium text-gray-900 dark:text-white">Connect√© en tant que:</div>
                                            <div id="userEmail" class="text-gray-500 dark:text-gray-400 truncate">
                                                <!-- Sera rempli par JS -->
                                            </div>
                                        </div>
                                        
                                        <button onclick="showUserProfile()" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                            <span class="icon-user mr-3"></span>Mon Profil
                                        </button>
                                        <button onclick="showSecuritySettings()" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                            <span class="icon-settings mr-3"></span>Param√®tres
                                        </button>
                                        <button onclick="showActivityLog()" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                            <span class="icon-history mr-3"></span>Journal d'activit√©
                                        </button>
                                        
                                        <div class="border-t my-1"></div>
                                        
                                        <button onclick="handleLogout()" class="w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700">
                                            <span class="icon-logout mr-3"></span>D√©connexion
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Navigation -->
            <nav class="bg-gray-800 dark:bg-gray-900 shadow-lg">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex space-x-8 overflow-x-auto">
                        <button onclick="showView('dashboard')" class="nav-item active flex items-center px-3 py-4 text-sm font-medium text-white border-b-2 border-primary whitespace-nowrap">
                            <span class="icon-dashboard mr-2"></span>Tableau de bord
                        </button>
                        <button onclick="showView('vehicles')" class="nav-item flex items-center px-3 py-4 text-sm font-medium text-gray-300 hover:text-white border-b-2 border-transparent hover:border-primary transition-all whitespace-nowrap">
                            <span class="icon-car mr-2"></span>V√©hicules
                        </button>
                        <button onclick="showView('detections')" class="nav-item flex items-center px-3 py-4 text-sm font-medium text-gray-300 hover:text-white border-b-2 border-transparent hover:border-primary transition-all whitespace-nowrap">
                            <span class="icon-search mr-2"></span>D√©tections
                        </button>
                        <button onclick="showView('rewards')" class="nav-item flex items-center px-3 py-4 text-sm font-medium text-gray-300 hover:text-white border-b-2 border-transparent hover:border-primary transition-all whitespace-nowrap">
                            <span class="icon-money mr-2"></span>R√©compenses
                        </button>
                        <button onclick="showView('stats')" class="nav-item flex items-center px-3 py-4 text-sm font-medium text-gray-300 hover:text-white border-b-2 border-transparent hover:border-primary transition-all whitespace-nowrap">
                            <span class="icon-chart mr-2"></span>Statistiques
                        </button>
                        <button id="userManagementTab" onclick="showView('users')" class="nav-item hidden flex items-center px-3 py-4 text-sm font-medium text-gray-300 hover:text-white border-b-2 border-transparent hover:border-primary transition-all whitespace-nowrap">
                            <span class="icon-users mr-2"></span>Utilisateurs
                        </button>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <main id="mainContent" class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 min-h-screen">
                <!-- Le contenu sera charg√© par l'application -->
                <div id="contentLoading" class="flex items-center justify-center py-12">
                    <div class="text-center">
                        <div class="loading-spinner mx-auto mb-4"></div>
                        <p class="text-gray-600 dark:text-gray-400">Chargement du contenu...</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal d'aide √† la connexion -->
    <div id="loginHelpModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 lg:w-1/3 shadow-lg rounded-md bg-white dark:bg-gray-800">
            <div class="mt-3">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">
                        <span class="icon-help text-primary mr-2"></span>
                        Aide √† la connexion
                    </h3>
                    <button onclick="closeLoginHelp()" class="text-gray-400 hover:text-gray-600">
                        <span class="icon-close"></span>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-lg">
                        <h4 class="font-medium text-blue-900 dark:text-blue-200 mb-2">Comptes par d√©faut</h4>
                        <div class="text-sm text-blue-800 dark:text-blue-300 space-y-2">
                            <p><strong>Admin Global:</strong></p>
                            <p>Email: admin.global@securAuto.cm</p>
                            <p>Mot de passe: SecurAuto2024!</p>
                            
                            <p class="mt-3"><strong>Admin L√©gion (exemple):</strong></p>
                            <p>Email: admin.centre@securAuto.cm</p>
                            <p>Mot de passe: SecurAuto2024!</p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 dark:bg-yellow-900 p-4 rounded-lg">
                        <h4 class="font-medium text-yellow-900 dark:text-yellow-200 mb-2">Premi√®re connexion</h4>
                        <p class="text-sm text-yellow-800 dark:text-yellow-300">
                            Si c'est votre premi√®re fois, acc√©dez d'abord √†:<br>
                            <code class="bg-yellow-200 dark:bg-yellow-800 px-1 rounded">index.html?init=true</code>
                        </p>
                    </div>
                    
                    <div class="bg-red-50 dark:bg-red-900 p-4 rounded-lg">
                        <h4 class="font-medium text-red-900 dark:text-red-200 mb-2">Support</h4>
                        <p class="text-sm text-red-800 dark:text-red-300">
                            En cas de probl√®me, contactez:<br>
                            support@securAuto.cm
                        </p>
                    </div>
                </div>
                
                <div class="mt-6 text-center">
                    <button onclick="closeLoginHelp()" class="btn btn-primary">
                        Fermer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Container -->
    <div id="notificationsContainer" class="fixed top-4 right-4 z-50 space-y-2 pointer-events-none">
        <!-- Les notifications toast seront ajout√©es ici -->
    </div>

    <!-- JavaScript Configuration et Fonctions -->
    <script>
        // Configuration globale avec votre vraie config Firebase
        window.APP_CONFIG = {
            version: '1.0.0',
            environment: 'production',
            firebaseConfig: {
                apiKey: "AIzaSyAOS5eDHnRXGXn4QpkOqm3z0kcChSlU0Ho",
                authDomain: "securauto-19756.firebaseapp.com",
                projectId: "securauto-19756",
                storageBucket: "securauto-19756.firebasestorage.app",
                messagingSenderId: "42127478765",
                appId: "1:42127478765:web:7800e4c81932e9af4561e4",
                measurementId: "G-3Q2KNVXZPS"
            }
        };
        
        // Variables globales
        let currentUser = null;
        let userRole = null;
        let isLoggedIn = false;
        
        // Fonctions utilitaires globales
        window.toggleDarkMode = function() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');
            const icon = document.getElementById('darkModeIcon');
            
            if (isDark) {
                html.classList.remove('dark');
                icon.className = 'icon-moon';
                localStorage.setItem('darkMode', 'false');
            } else {
                html.classList.add('dark');
                icon.className = 'icon-sun';
                localStorage.setItem('darkMode', 'true');
            }
        };
        
        window.togglePasswordVisibility = function() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('passwordToggleIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'icon-eye-off text-gray-400 hover:text-gray-600';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'icon-eye text-gray-400 hover:text-gray-600';
            }
        };
        
        window.showLoginHelp = function() {
            document.getElementById('loginHelpModal').classList.remove('hidden');
        };
        
        window.closeLoginHelp = function() {
            document.getElementById('loginHelpModal').classList.add('hidden');
        };
        
        window.toggleNotifications = function() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('hidden');
        };
        
        window.toggleUserMenu = function() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        };
        
        // Fonction de connexion
        window.handleLogin = async function(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('loginButton');
            const loginText = document.getElementById('loginText');
            const loginLoader = document.getElementById('loginLoader');
            
            // Validation basique
            if (!email || !password) {
                showAlert('Veuillez remplir tous les champs', 'error');
                return;
            }
            
            // Afficher le loader
            loginButton.disabled = true;
            loginText.textContent = 'Connexion...';
            loginLoader.classList.remove('hidden');
            
            try {
                // Authentification Firebase
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // V√©rifier si c'est un admin
                const adminDoc = await firebase.firestore().collection('admin_users').where('email', '==', email).get();
                
                if (adminDoc.empty) {
                    await firebase.auth().signOut();
                    throw new Error('Acc√®s administrateur non autoris√©');
                }
                
                const adminData = adminDoc.docs[0].data();
                
                if (!adminData.isActive) {
                    await firebase.auth().signOut();
                    throw new Error('Compte administrateur d√©sactiv√©');
                }
                
                // Stocker les infos utilisateur
                currentUser = user;
                userRole = adminData.role;
                isLoggedIn = true;
                
                // Log de connexion
                await firebase.firestore().collection('admin_logs').add({
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    userId: user.uid,
                    userEmail: user.email,
                    action: 'LOGIN_SUCCESS',
                    details: { role: adminData.role, region: adminData.region },
                    ipAddress: 'unknown',
                    userAgent: navigator.userAgent.substring(0, 200)
                });
                
                // Afficher l'interface admin
                showAdminInterface(adminData);
                showAlert('Connexion r√©ussie', 'success');
                
            } catch (error) {
                console.error('Erreur de connexion:', error);
                let errorMessage = 'Erreur de connexion';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                    case 'auth/wrong-password':
                        errorMessage = 'Email ou mot de passe incorrect';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Trop de tentatives. R√©essayez plus tard.';
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                showAlert(errorMessage, 'error');
            } finally {
                // Masquer le loader
                loginButton.disabled = false;
                loginText.textContent = 'Se connecter';
                loginLoader.classList.add('hidden');
            }
        };
        
        // Fonction de d√©connexion
        window.handleLogout = async function() {
            try {
                if (currentUser) {
                    await firebase.firestore().collection('admin_logs').add({
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        userId: currentUser.uid,
                        userEmail: currentUser.email,
                        action: 'LOGOUT',
                        details: {},
                        ipAddress: 'unknown',
                        userAgent: navigator.userAgent.substring(0, 200)
                    });
                }
                
                await firebase.auth().signOut();
                
                // R√©initialiser les variables
                currentUser = null;
                userRole = null;
                isLoggedIn = false;
                
                // Retourner √† l'√©cran de connexion
                showLoginScreen();
                showAlert('D√©connexion r√©ussie', 'info');
                
            } catch (error) {
                console.error('Erreur de d√©connexion:', error);
                showAlert('Erreur lors de la d√©connexion', 'error');
            }
        };
        
        // Fonction pour afficher l'interface admin
        function showAdminInterface(adminData) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            
            // Remplir les informations utilisateur
            document.getElementById('userName').textContent = adminData.displayName || currentUser.email;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userRoleBadge').textContent = adminData.role === 'global_admin' ? 'Admin Global' : 'Admin L√©gion';
            
            if (adminData.region && adminData.region !== 'ALL') {
                const regionBadge = document.getElementById('userRegionBadge');
                regionBadge.textContent = adminData.region;
                regionBadge.classList.remove('hidden');
            }
            
            // Afficher l'onglet gestion utilisateurs pour l'admin global
            if (adminData.role === 'global_admin') {
                document.getElementById('userManagementTab').classList.remove('hidden');
            }
            
            // Charger le contenu par d√©faut
            showView('dashboard');
        }
        
        // Fonction pour retourner √† l'√©cran de connexion
        function showLoginScreen() {
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        }
        
        // Fonctions placeholder pour les vues
        window.showView = function(view) {
            console.log('Affichage de la vue:', view);
            
            // Mise √† jour de la navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active', 'text-white', 'border-primary');
                item.classList.add('text-gray-300', 'border-transparent');
            });
            
            const activeItem = event?.target || document.querySelector(`[onclick="showView('${view}')"]`);
            if (activeItem) {
                activeItem.classList.add('active', 'text-white', 'border-primary');
                activeItem.classList.remove('text-gray-300', 'border-transparent');
            }
            
            // Chargement du contenu basique
            const content = document.getElementById('mainContent');
            content.innerHTML = `
                <div class="text-center py-12">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
                        ${getViewTitle(view)}
                    </h2>
                    <p class="text-gray-600 dark:text-gray-400">
                        Cette section sera impl√©ment√©e dans les prochaines versions.
                    </p>
                    <div class="mt-8 p-6 bg-blue-50 dark:bg-blue-900 rounded-lg max-w-md mx-auto">
                        <p class="text-blue-800 dark:text-blue-200 text-sm">
                            Pour le moment, vous pouvez utiliser cette interface pour tester la connexion et la navigation.
                        </p>
                    </div>
                </div>
            `;
        };
        
        function getViewTitle(view) {
            const titles = {
                dashboard: 'Tableau de Bord',
                vehicles: 'Gestion des V√©hicules',
                detections: 'D√©tections',
                rewards: 'Gestion des R√©compenses',
                stats: 'Statistiques',
                users: 'Gestion des Utilisateurs'
            };
            return titles[view] || 'Section';
        }
        
        // Fonctions placeholder pour les autres actions
        window.showUserProfile = function() {
            showAlert('Profil utilisateur - En d√©veloppement', 'info');
        };
        
        window.showSecuritySettings = function() {
            showAlert('Param√®tres de s√©curit√© - En d√©veloppement', 'info');
        };
        
        window.showActivityLog = function() {
            showAlert('Journal d\'activit√© - En d√©veloppement', 'info');
        };
        
        // Fonction pour afficher les alertes
        function showAlert(message, type = 'info') {
            const container = document.getElementById('notificationsContainer');
            const alert = document.createElement('div');
            
            const colors = {
                success: 'bg-green-100 border-green-400 text-green-700',
                error: 'bg-red-100 border-red-400 text-red-700',
                warning: 'bg-yellow-100 border-yellow-400 text-yellow-700',
                info: 'bg-blue-100 border-blue-400 text-blue-700'
            };
            
            alert.className = `p-4 border rounded-md shadow-lg max-w-sm pointer-events-auto ${colors[type] || colors.info}`;
            alert.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-gray-500 hover:text-gray-700">
                        <span class="icon-close text-sm"></span>
                    </button>
                </div>
            `;
            
            container.appendChild(alert);
            
            // Supprimer automatiquement apr√®s 5 secondes
            setTimeout(() => {
                if (alert.parentElement) {
                    alert.remove();
                }
            }, 5000);
        }
        
        // Initialisation du mode sombre
        function initializeDarkMode() {
            const savedMode = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const shouldBeDark = savedMode === 'true' || (savedMode === null && prefersDark);
            
            if (shouldBeDark) {
                document.documentElement.classList.add('dark');
                const icon = document.getElementById('darkModeIcon');
                if (icon) icon.className = 'icon-sun';
            }
        }
        
        // Gestion des clics en dehors des menus
        document.addEventListener('click', function(event) {
            const notificationButton = document.getElementById('notificationButton');
            const notificationPanel = document.getElementById('notificationPanel');
            const userMenuButton = document.getElementById('userMenuButton');
            const userMenu = document.getElementById('userMenu');
            
            // Fermer notification panel
            if (notificationButton && notificationPanel && 
                !notificationButton.contains(event.target) && 
                !notificationPanel.contains(event.target)) {
                notificationPanel.classList.add('hidden');
            }
            
            // Fermer user menu
            if (userMenuButton && userMenu && 
                !userMenuButton.contains(event.target) && 
                !userMenu.contains(event.target)) {
                userMenu.classList.add('hidden');
            }
        });
        
        // D√©tection de l'initialisation
        function checkForInitialization() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('init') === 'true') {
                console.log('üöÄ Mode initialisation d√©tect√©');
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('initializationScreen').classList.remove('hidden');
                return true;
            }
            return false;
        }
        
        // Initialisation au chargement
        document.addEventListener('DOMContentLoaded', function() {
            initializeDarkMode();
            
            // V√©rifier si c'est une initialisation
            if (checkForInitialization()) {
                // Lancer l'initialisation
                setTimeout(() => {
                    runInitialization();
                }, 1000);
            } else {
                // Masquer l'√©cran de chargement et afficher la page de connexion
                setTimeout(() => {
                    document.getElementById('loadingScreen').classList.add('hidden');
                    document.getElementById('loginScreen').classList.remove('hidden');
                }, 2000);
            }
        });
        
        // Fonction d'initialisation R√âELLE
        async function runInitialization() {
            const progressDiv = document.getElementById('initProgress');
            
            try {
                // Cr√©er l'instance de migration r√©elle
                const migration = new RealDatabaseMigration();
                
                // V√©rifier si d√©j√† initialis√©
                await migration.initializeFirebase();
                const alreadyInitialized = await migration.checkIfAlreadyInitialized();
                
                if (alreadyInitialized) {
                    updateProgress('Syst√®me d√©j√† initialis√© !', 'check');
                    showAlreadyInitialized();
                    return;
                }
                
                // Fonction callback pour mettre √† jour le progr√®s
                function updateProgressCallback(message, icon) {
                    updateProgress(message, icon);
                }
                
                // Lancer la vraie migration
                await migration.runRealMigration(updateProgressCallback);
                
                // Afficher les informations de finalisation
                showInitializationComplete();
                
            } catch (error) {
                console.error('Erreur lors de l\'initialisation:', error);
                updateProgress(`Erreur: ${error.message}`, 'error');
                showInitializationError(error);
            }
        }
        
        function updateProgress(message, icon) {
            const progressDiv = document.getElementById('initProgress');
            const iconMap = {
                'sync': 'üîÑ',
                'users': 'üë•',
                'settings': '‚öôÔ∏è',
                'money': 'üí∞',
                'history': 'üìú',
                'check': '‚úÖ',
                'error': '‚ùå'
            };
            
            progressDiv.innerHTML += `
                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400 mt-2">
                    <span class="mr-2 text-green-500">${iconMap[icon] || 'üîÑ'}</span>
                    <span>${message}</span>
                </div>
            `;
        }
        
        function showInitializationComplete() {
            const initScreen = document.getElementById('initializationScreen');
            initScreen.innerHTML = `
                <div class="text-center max-w-lg mx-auto p-8">
                    <div class="mb-6">
                        <div class="h-16 w-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="icon-check text-white text-2xl"></span>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
                        Initialisation termin√©e !
                    </h2>
                    <div class="space-y-4 text-left">
                        <div class="bg-green-50 dark:bg-green-900 p-4 rounded-lg">
                            <h3 class="font-bold text-green-900 dark:text-green-200 mb-2">‚úÖ Collections cr√©√©es :</h3>
                            <div class="text-sm text-green-800 dark:text-green-300 space-y-1">
                                <p>‚Ä¢ admin_users (comptes administrateurs)</p>
                                <p>‚Ä¢ admin_logs (journaux d'activit√©)</p>
                                <p>‚Ä¢ system_settings (param√®tres syst√®me)</p>
                                <p>‚Ä¢ rewards (gestion des r√©compenses)</p>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-lg">
                            <h3 class="font-bold text-blue-900 dark:text-blue-200 mb-2">üë§ Comptes cr√©√©s :</h3>
                            <div class="text-sm text-blue-800 dark:text-blue-300 space-y-1">
                                <p><strong>Admin Global :</strong> admin.global@securAuto.cm</p>
                                <p><strong>Admin Centre :</strong> admin.centre@securAuto.cm</p>
                                <p><strong>Admin Littoral :</strong> admin.littoral@securAuto.cm</p>
                                <p><strong>Mot de passe :</strong> SecurAuto2024!</p>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 dark:bg-yellow-900 p-4 rounded-lg">
                            <h3 class="font-bold text-yellow-900 dark:text-yellow-200 mb-2">‚ö†Ô∏è Prochaines √©tapes :</h3>
                            <div class="text-sm text-yellow-800 dark:text-yellow-300 space-y-1">
                                <p>1. Cr√©ez les comptes Firebase Auth correspondants</p>
                                <p>2. Configurez les r√®gles de s√©curit√© Firestore</p>
                                <p>3. Modifiez les mots de passe par d√©faut</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 space-y-3">
                        <button onclick="goToLogin()" class="btn btn-primary w-full">
                            Acc√©der √† la connexion
                        </button>
                        <button onclick="window.location.reload()" class="btn btn-secondary w-full">
                            Red√©marrer l'initialisation
                        </button>
                    </div>
                </div>
            `;
        }
        
        function showAlreadyInitialized() {
            const initScreen = document.getElementById('initializationScreen');
            initScreen.innerHTML = `
                <div class="text-center max-w-lg mx-auto p-8">
                    <div class="mb-6">
                        <div class="h-16 w-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="icon-info text-white text-2xl"></span>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
                        Syst√®me d√©j√† initialis√©
                    </h2>
                    <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-lg mb-6">
                        <p class="text-blue-800 dark:text-blue-200">
                            Les collections et comptes administrateurs sont d√©j√† configur√©s dans votre base de donn√©es Firebase.
                        </p>
                    </div>
                    <button onclick="goToLogin()" class="btn btn-primary w-full">
                        Acc√©der √† la connexion
                    </button>
                </div>
            `;
        }
        
        function showInitializationError(error) {
            const initScreen = document.getElementById('initializationScreen');
            initScreen.innerHTML = `
                <div class="text-center max-w-lg mx-auto p-8">
                    <div class="mb-6">
                        <div class="h-16 w-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="icon-error text-white text-2xl"></span>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
                        Erreur d'initialisation
                    </h2>
                    <div class="bg-red-50 dark:bg-red-900 p-4 rounded-lg mb-6">
                        <p class="text-red-800 dark:text-red-200 mb-2">
                            <strong>Erreur :</strong> ${error.message}
                        </p>
                        <div class="text-sm text-red-700 dark:text-red-300 text-left">
                            <p><strong>V√©rifications :</strong></p>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li>Configuration Firebase correcte</li>
                                <li>Permissions Firestore configur√©es</li>
                                <li>Connexion Internet active</li>
                                <li>Console du navigateur pour plus de d√©tails</li>
                            </ul>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <button onclick="window.location.reload()" class="btn btn-primary w-full">
                            R√©essayer l'initialisation
                        </button>
                        <button onclick="goToLogin()" class="btn btn-secondary w-full">
                            Ignorer et aller √† la connexion
                        </button>
                    </div>
                </div>
            `;
        }
        
        window.goToLogin = function() {
            // Supprimer le param√®tre init de l'URL
            const url = new URL(window.location);
            url.searchParams.delete('init');
            window.history.replaceState({}, document.title, url.toString());
            
            // Masquer l'√©cran d'initialisation et afficher la connexion
            document.getElementById('initializationScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        };
    </script>

    <!-- Charger le script de migration r√©elle -->
    <script src="js/utils/real-database-migration.js"></script>
    
    <!-- Initialisation Firebase -->
    <script>
        // Initialiser Firebase avec votre configuration
        if (!firebase.apps.length) {
            firebase.initializeApp(window.APP_CONFIG.firebaseConfig);
        }
        
        console.log('üöÄ SecurAuto Admin charg√©');
        console.log('Version:', window.APP_CONFIG.version);
        console.log('Firebase Project:', window.APP_CONFIG.firebaseConfig.projectId);
    </script>
</body>
</html>